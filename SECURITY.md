# ðŸ›¡ï¸ Security Policy

> **WARNING:** This system (PENNY Knowledge Core) operates with **High Privileges**. It requires access to your AnyType Recovery Phrase (Mnemonic). If this key is compromised, your entire encrypted vault is compromised.

This document outlines the security architecture, data boundaries, and operational red lines that must be observed when deploying and developing this system.

## 1. The Core Principle: Zero-Knowledge Retention

The PENNY Knowledge Core is designed to be a **transient operator**. It should hold keys in memory only for the duration of the container's lifecycle.

* **No Persistent Storage of Keys:** Mnemonics must **never** be written to disk, databases, or logs. They are injected strictly via environment variables at runtime.
* **Ephemeral Containers:** The "Heart" containers should be treated as ephemeral. If a container is compromised or behaves abnormally, it should be terminated immediately.

## 2. Infrastructure & Network Isolation

The "Hydra" fleet architecture relies on strict network segmentation to prevent data leaks.

### Docker Network Topology

* **Internal Network (`penny-net`):** A private Docker bridge network.
* **Allowed:** `penny-gateway` talking to `anytype-heart-*`.
* **Blocked:** Direct external access to `anytype-heart-*` API ports (e.g., `31009`).


* **Ingress:** Only the `penny-gateway` (Router) should expose a port (e.g., `8000`) to the host machine or tailnet.
* **Egress:** `anytype-heart` containers require egress to the Any-Sync network (TCP/443, UDP/QUIC). This egress should be whitelisted if possible.

### Deployment Hardening

* **Do not expose the Gateway to the public internet.** This system is intended for **Localhost** or **VPN (Tailscale/WireGuard)** access only.
* **Authentication:** The Gateway does not currently implement robust auth. It relies on the security of the host network. If deploying on a VPS, **you must** put it behind a reverse proxy (Nginx/Caddy) with Basic Auth or OAuth2.

## 3. Secrets Management

### Handling the Mnemonic

* **Storage:** Store your 12-word phrase in a secure `.env` file (which is `.gitignore`'d) or a secret manager (like 1Password CLI, AWS Secrets Manager, or Doppler).
* **Injection:** Pass the mnemonic to the Docker container as an environment variable (`MNEMONIC`).
* **Logging Ban:** Developers must ensure that no log statements print the `MNEMONIC` or the generated `AUTH_TOKEN`.

### API Keys

* The internal communication between `penny-gateway` and `anytype-heart` uses an Authorization Token. This token is auto-generated by the Heart on startup.
* It is printed to the container logs one time on startup. This is acceptable for local debugging but should be suppressed in production logging drivers.

## 4. Operational "Red Lines" (Agent Boundaries)

To prevent the Agent from destroying data or leaking privacy, the following hard constraints are implemented in the code (not just the prompt):

1. **Relation Deduplication:** The Agent is strictly forbidden from creating a new Relation without first checking the Global Relation Dictionary for a fuzzy match. This prevents "Schema Pollution."
2. **No Delete Capability:** By default, the `delete_object` and `delete_space` tools should be **disabled** or require a specific "human-in-the-loop" confirmation flag.
3. **Scope Containment:** An Agent initialized with the "Personal" profile keys **cannot** access data from the "Work" profile container. This is enforced by the Docker isolationâ€”they are separate processes with separate databases.

## 5. Reporting a Vulnerability

If you discover a security vulnerability in this project, please **do not open a public issue**.

1. Email the core maintainers directly.
2. Describe the vulnerability and providing a reproduction case.
3. We will issue a patch within 48 hours.

## 6. Self-Hosting Risks

If you choose to self-host the Any-Sync network (backup nodes) alongside this agent:

* Ensure your `network.yml` configuration is correctly mounted into the Heart container.
* Misconfiguration here can lead to data not syncing to your other devices, effectively creating a "fork" of your data that exists only inside the container.

---

### Security Checklist for Deployment

* [ ] `.env` file is added to `.gitignore`.
* [ ] Docker API ports (`31009`) are NOT mapped to `0.0.0.0` on the host (bind to `127.0.0.1` or internal network only).
* [ ] The host machine has a firewall enabled (UFW/IPTables).
* [ ] You have a backup of your AnyType Recovery Phrase stored offline.
